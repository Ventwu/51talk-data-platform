# 51Talk数据中台业务功能开发 - 对齐文档

## 1. 项目上下文分析

### 1.1 现有项目架构
- **前端**: React + TypeScript + Vite + Ant Design
- **后端**: Node.js + Express + TypeScript
- **数据库**: MySQL (已设计schema)
- **开发环境**: 前后端服务已启动并运行正常

### 1.2 已完成基础设施
- ✅ 项目结构搭建
- ✅ 前后端框架初始化
- ✅ 数据库设计和初始化脚本
- ✅ 基础路由和中间件配置
- ✅ 开发环境配置

### 1.3 技术栈对齐
**规划文档 vs 实际实现**:
- 前端框架: Vue.js 3 → **React 18** (已实现)
- UI组件库: Element Plus → **Ant Design** (已实现)
- 图表库: ECharts → **需要集成**
- 后端框架: Express.js ✅ (已实现)
- 数据库: MySQL ✅ (已设计)

## 2. 原始需求分析

基于产品规划文档，核心业务功能包括:

### 2.1 核心功能模块
1. **用户认证系统**
   - 登录/注册
   - 角色权限管理 (admin, analyst, viewer)
   - JWT token认证

2. **数据源管理**
   - 多数据库连接配置 (MySQL, PostgreSQL, MongoDB)
   - 连接测试和验证
   - 数据源CRUD操作

3. **仪表盘设计器**
   - 拖拽式布局设计
   - 图表组件库 (柱状图、折线图、饼图、表格)
   - 数据绑定和配置

4. **数据处理引擎**
   - SQL查询构建器
   - 数据转换和计算
   - 实时数据刷新

5. **首页仪表盘**
   - 个性化数据展示
   - 多仪表盘管理
   - 权限控制

### 2.2 辅助功能
- 模板管理
- 数据导出 (Excel, PDF)
- 预警通知

## 3. 边界确认

### 3.1 本次开发范围
**Phase 1 - 核心MVP功能**:
- ✅ 用户认证系统 (登录/注册)
- ✅ 数据源管理基础功能
- ✅ 简单仪表盘展示
- ✅ 基础图表组件

**Phase 2 - 高级功能** (后续迭代):
- 复杂仪表盘设计器
- 高级数据处理
- 预警通知系统

### 3.2 技术边界
- 使用现有技术栈 (React + Node.js)
- 复用已有组件和模式
- 确保与现有架构兼容

### 3.3 时间边界
- 专注于核心功能实现
- 避免过度设计
- 优先可用性而非完美性

## 4. 需求理解

### 4.1 用户角色和权限
```typescript
interface UserRole {
  admin: {
    permissions: ['manage_users', 'manage_datasources', 'manage_dashboards', 'view_all']
  }
  analyst: {
    permissions: ['create_dashboards', 'manage_own_dashboards', 'view_assigned']
  }
  viewer: {
    permissions: ['view_assigned_dashboards']
  }
}
```

### 4.2 数据流架构
```
用户登录 → 选择/创建仪表盘 → 配置数据源 → 添加图表组件 → 数据查询 → 图表渲染
```

### 4.3 核心实体关系
- User (1:N) Dashboard
- Dashboard (1:N) Chart
- Chart (N:1) DataSource
- DataSource (1:N) Query

## 5. 疑问澄清

### 已明确的决策
- 技术栈：前端React + TypeScript，后端Node.js + Express
- 开发策略：MVP优先，用户认证和权限控制最后开发
- 数据库：支持多种数据库（MySQL, PostgreSQL, SQLite）
- 图表库：优先使用ECharts，支持复杂配置
- 数据更新：支持定时刷新和推送通知
- 通知方式：飞书机器人和企业微信应用机器人（webhook）

### 开发优先级（已确认）

#### 第一阶段：核心MVP功能
1. **多数据库支持** - 实现MySQL, PostgreSQL, SQLite连接
2. **图表组件库** - 支持复杂配置的图表组件
3. **仪表盘设计器** - 拖拽式仪表盘创建

#### 第二阶段：数据处理功能
4. **定时数据刷新** - 自动更新数据源数据
5. **通知推送系统** - 飞书/企业微信机器人推送

#### 第三阶段：用户系统
6. **用户认证和权限控制** - 最后开发

### 技术实现方案（已确认）

#### 多数据库支持
- 使用Sequelize ORM支持多种数据库
- 动态数据库连接配置
- 统一的数据访问接口

#### 图表组件复杂配置
- 基于ECharts的可配置图表组件
- 支持样式、数据、交互的深度定制
- 可视化配置界面

#### 通知推送系统
- 支持webhook方式推送到飞书/企业微信
- 可配置推送规则和模板
- 定时任务触发推送

## 6. 技术约束

### 6.1 现有架构约束
- 必须与现有Express后端兼容
- 使用现有数据库schema
- 遵循现有代码规范和目录结构

### 6.2 性能约束
- 页面响应时间 < 3秒
- 支持50+并发用户
- 图表渲染性能优化

### 6.3 安全约束
- JWT token安全
- 数据库连接信息加密
- SQL注入防护
- XSS防护

## 7. 验收标准

### 7.1 功能验收
- [ ] 用户可以注册、登录、登出
- [ ] 管理员可以管理数据源配置
- [ ] 用户可以创建和查看仪表盘
- [ ] 支持基础图表类型 (柱状图、折线图、饼图、表格)
- [ ] 数据可以正确查询和展示

### 7.2 技术验收
- [ ] 代码通过TypeScript类型检查
- [ ] 前后端API接口正常工作
- [ ] 数据库操作正常
- [ ] 响应式设计适配

### 7.3 用户体验验收
- [ ] 界面美观易用
- [ ] 操作流程顺畅
- [ ] 错误提示友好
- [ ] 加载状态明确

---

**文档状态**: 初始版本  
**创建时间**: 2024-01-24  
**下一步**: 等待关键决策确认，然后进入共识阶段